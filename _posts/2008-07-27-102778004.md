---
title: "Poisson Image Editing"
category: life
---

<p><a href="http://www.cs.tau.ac.il/~tommer/adv-graphics/ex1.htm">Poisson Image Editing. SIGGRAPH2003. </a></p>
<p>Patrick Perez, Michel Gangnet and Andrew Blake. </p>

<p>做了近一周多，时间都用在MFC、CxImage库和稀疏矩阵求解库的使用上了，Poisson算法倒是很明了，在Intel MKL库调试成功当天完成的。那个开源的TAUCS库怎么也放不到MFC中，最后只好用MKL了。这个算法的效果不是很好，Microsoft Research Asia和The Chinese University of Hong Kong的Drag-and-Drop Pasting策略效果改进很多了，主要优化了下边界和透明度处理，有时间一定也去实现下。</p>
<p>在生成Release版本时又遇到了问题，后来请教了牛人学长才得知，要生成Release版则库一般也要相应的是Release的。解释是，如果库的内存分配操作在内部实现，就一定也要Release的，而像OpenCV库的对象内存都是在库外分配的，所以Debug和Release可以用同一版本的lib。因为这个程序的运算量比较大，才发现Release比Debug明显快了很多！</p>

<p><img class="blogimg" border="0" small="0" src="http://hiphotos.baidu.com/maxint/pic/item/0be8eb24a355b33cd5074207.jpg"></p>

<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes"><font face="宋体">//////////////////////////////////////////////////////////////////////////</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><font face="宋体"><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">// Poisson</span><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">求解函数</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes"><font face="宋体">// Input:</font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><font face="宋体"><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">//<span style="mso-tab-count: 1">&nbsp;&nbsp;    </span>idata,iwidth,iheight,istep<span style="mso-tab-count: 1"> </span></span><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">源图像及其宽高和每行步长</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><font face="宋体"><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">//<span style="mso-tab-count: 1">&nbsp;&nbsp;    </span>pSel </span><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">选区<span>,<span style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;    </span>offsetx,offsety </span>源图像在目标图像上的偏移量，选区大小与源图像相等</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><font face="宋体"><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">//<span style="mso-spacerun: yes"> </span>odata,owidth,oheight,,ostep </span><span style="font-size: 9pt; color: green; mso-hansi-: 0pt; mso-no-proof: yes">目标图像及其宽高和每行步长</span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"> </p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><font face="宋体"><span style="font-size: 9pt; color: blue; mso-hansi-: 0pt; mso-no-proof: yes">void</span><span style="font-size: 9pt; mso-hansi-: 0pt; mso-no-proof: yes"> <span style="color: black">CSolver</span>::<span style="color: black">Solve</span>(<span style="color: blue">const</span> <span style="color: black">BYTE</span> *<span style="color: black">idata</span>, <span style="color: blue">int</span> <span style="color: black">iwidth</span>, <span style="color: blue">int</span> <span style="color: black">iheight</span>, <span style="color: blue">int</span> <span style="color: black">istep</span>, </span></font></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt; text-align: left; mso-layout-grid-align: none" align="left"><span style="font-size: 9pt; mso-hansi-: 0pt; mso-no-proof: yes"><font face="宋体"><span style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    </span><span style="color: blue">const</span> <span style="color: black">BYTE</span> *<span style="color: black">pSel</span>, <span style="color: blue">const</span> <span style="color: black">UINT</span> <span style="color: black">offsetx</span>, <span style="color: blue">const</span> <span style="color: black">UINT</span> <span style="color: black">offsety</span>, </font></span></p>
<p class="MsoNormal" style="margin: 0cm 0cm 0pt"><span style="font-size: 9pt; mso-hansi-: 0pt; mso-no-proof: yes"><font face="宋体"><span style="mso-tab-count: 5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    </span><span style="color: black">BYTE</span> *<span style="color: black">odata</span>, <span style="color: blue">int</span> <span style="color: black">owidth</span>, <span style="color: blue">int</span> <span style="color: black">oheight</span>, <span style="color: blue">int</span> <span style="color: black">ostep</span>)</font></span></p>